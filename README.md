# Light switch example

> This example has only been tested with the nRF52840 series.

Throughput test based on Nordics light switch example.


## Setup
- Download and install the [generic message model for mesh](https://github.com/stby4/nrf_mesh_generic_message_model).
- Go to the 'nrf5SDKforMeshv310src\examples' folder
- `git clone git@github.com:stby4/nrf_mesh_throughput.git throughput`
- Open the 'throughput' folder. You will find seperate projects for the client, the server and the provisioner.



## Hardware requirements

You need at least two supported boards for this example:

- One nRF52840 development board for the client.
- One or more nRF52840 development boards for the servers.

Additionally, you need one of the following:
- One nRF5 development board for the provisioner if you decide to use the static provisioner example.
- _nRF Mesh_ app for [Android](https://play.google.com/store/apps/details?id=no.nordicsemi.android.nrfmeshprovisioner) or [iOS](https://apps.apple.com/us/app/nrf-mesh/id1380726771) if you decide to provision using the application.


---


## Testing

To test the throughput, build the examples with Segger Embedded Studio.


> If you have more than 30 boards for the servers and decided to use the static provisioner example, set `SERVER_NODE_COUNT` in `light_switch_example_common.h` to the number of boards available and rebuild the provisioner example.

After building is complete, use one of the following methods, depending on the preferred
provisioning approach:
- Evaluating using the static provisioner
-[Evaluating using the nRF Mesh mobile app

Once the provisioning is complete, you can start the throughput test.

### Evaluating using the static provisioner

> So far, the static provisioner has not been implemented. Please use the nRF Mesh app or create your own provisioner.

1. Flash the examples by following the instructions in @ref md_doc_getting_started_how_to_run_examples,
including:
    1. Erase the flash of your development boards and program the SoftDevice.
    2. Flash the provisioner and the client firmware on individual boards and the server firmware on other boards.
2. After the reset at the end of the flashing process, press Button 1 on the provisioner board
to start the provisioning process:
    - The provisioner first provisions and configures the client and assigns the address 0x100 to the client
    node.
    - The two instances of the OnOff client models are instantiated on separate secondary elements.
    For this reason, they get consecutive addresses starting with 0x101.
    - Finally, the provisioner picks up the available devices at random, assigns them consecutive addresses,
    and adds them to odd and even groups.
@note You can use [RTT viewer](@ref segger-rtt) to view the RTT output generated by the provisioner.
The provisioner prints details about the provisioning and the configuration process in the RTT log.
3. Observe that the LED 1 on the provisioner board is turned ON when provisioner is scanning and provisioning a device.
4. Observe that the LED 2 on the provisioner board is turned ON when configuration procedure is in progress.
5. Wait until LED 1 on the provisioner board remains ON steadily for a few seconds, which indicates that
all available boards have been provisioned and configured.

If the provisioner encounters an error during the provisioning or configuration process for a certain node,
you can reset the provisioner to restart this process for that node.


### Evaluating using the nRF Mesh mobile app

1. Flash the examples by following the instructions:
    1. Erase the flash of your development boards and program the SoftDevice.
    2. Flash the client firmware on individual boards and the server firmware on other board or boards.
2. Open the nRF Mesh mobile app.
3. Provision the nodes. The client board is `nRF5x Message Client`,
the server board is `nRF5x Message Server`.
4. Bind the Generic OnOff client and server model instances on the nodes with the same app key:
    1. Select the Network tab.
    2. On the server board tile, tap the **Configure** button to open Node Configuration.
    3. Expand the Elements section and tap **Generic OnOff Server**.
    4. In the Bound App Keys section, tap the **Bind Key** button and select the app key.
    5. On the client board tile, tap the **Configure** button to open Node Configuration.
    6. Expand the Elements section and tap **Generic OnOff Client**.
    7. In the Bound App Keys section, tap the **Bind Key** button and select the app key.
6. In the client Node Configuration, expand the Elements section. 
7. Select the first Generic OnOff Client model instance.
8. In the Publish section, set the Publish Address to one of the following addresses of the server nodes:
    - the unicast address of any server node. This configures the client example as follows:
        - The Button 1 on the client board turns ON LED 1 on the corresponding server board.
        - The Button 2 on the client board turns OFF LED 1 on the corresponding server board.
    - group addresses -- if you choose this option, remember to subscribe the server nodes to these
    group addresses.
        
> You can also configure the publish address of the second Generic OnOff client model instance. Use one of the options mentioned in step 5 above. If you set the address the unicast address of any server node, the client example will be configured as follows:
>    - The Button 3 on the client board turns ON LED 1 on the corresponding server board.
>    - The Button 4 on the client board turns OFF LED 1 on the corresponding server board.


### Interacting with the boards

@todo